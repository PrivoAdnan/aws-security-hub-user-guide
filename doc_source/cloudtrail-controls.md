# AWS CloudTrail controls<a name="cloudtrail-controls"></a>

These controls are related to CloudTrail resources\.

## \[CloudTrail\.1\] CloudTrail should be enabled and configured with at least one multi\-Region trail that includes read and write management events<a name="cloudtrail-1"></a>

**Related requirements:** CIS AWS Foundations Benchmark v1\.2\.0/2\.1, CIS AWS Foundations Benchmark v1\.4\.0/3\.1, NIST\.800\-53\.r5 AC\-2\(4\), NIST\.800\-53\.r5 AC\-4\(26\), NIST\.800\-53\.r5 AC\-6\(9\), NIST\.800\-53\.r5 AU\-10, NIST\.800\-53\.r5 AU\-12, NIST\.800\-53\.r5 AU\-2, NIST\.800\-53\.r5 AU\-3, NIST\.800\-53\.r5 AU\-6\(3\), NIST\.800\-53\.r5 AU\-6\(4\), NIST\.800\-53\.r5 AU\-14\(1\), NIST\.800\-53\.r5 CA\-7, NIST\.800\-53\.r5 SC\-7\(9\), NIST\.800\-53\.r5 SI\-3\(8\), NIST\.800\-53\.r5 SI\-4\(20\), NIST\.800\-53\.r5 SI\-7\(8\), NIST\.800\-53\.r5 SA\-8\(22\)

**Category:** Identify > Logging

**Severity:** High

**Resource type:** AWS account

**AWS Config rule:** [https://docs.aws.amazon.com/config/latest/developerguide/multi-region-cloudtrail-enabled.html](https://docs.aws.amazon.com/config/latest/developerguide/multi-region-cloudtrail-enabled.html)

**Schedule type:** Periodic

**Parameters:**
+ `readWriteType`: `ALL`

This control checks that there is at least one multi\-Region CloudTrail trail\. It also checks that the `ExcludeManagementEventSources` parameter is empty for at least one of those trails\.

AWS CloudTrail records AWS API calls for your account and delivers log files to you\. The recorded information includes the following information\.
+ Identity of the API caller
+ Time of the API call
+ Source IP address of the API caller
+ Request parameters
+ Response elements returned by the AWS service

CloudTrail provides a history of AWS API calls for an account, including API calls made from the AWS Management Console, AWS SDKs, command line tools\. The history also includes API calls from higher\-level AWS services such as AWS CloudFormation\.

The AWS API call history produced by CloudTrail enables security analysis, resource change tracking, and compliance auditing\. Multi\-Region trails also provide the following benefits\.
+ A multi\-Region trail helps to detect unexpected activity occurring in otherwise unused Regions\.
+ A multi\-Region trail ensures that global service event logging is enabled for a trail by default\. Global service event logging records events generated by AWS global services\.
+ For a multi\-Region trail, management events for all read and write operations ensure that CloudTrail records management operations on all resources in an AWS account\.

By default, CloudTrail trails that are created using the AWS Management Console are multi\-Region trails\.

**Note**  
This control is not supported in Middle East \(UAE\)\.

### Remediation<a name="cloudtrail-1-remediation"></a>

To remediate this issue, create a new multi\-Region trail in CloudTrail\.

**To create a new trail in CloudTrail**

1. Open the CloudTrail console at [https://console\.aws\.amazon\.com/cloudtrail/](https://console.aws.amazon.com/cloudtrail/)\.

1. If you haven't used CloudTrail before, choose **Get Started Now**\.

1. Choose **Trails** and then choose **Create trail**\.

1. Enter a name for the trail\.

1. Under **Storage location**, do one of the following:

   1. To create a new S3 bucket for CloudTrail logs, for **Create a new S3 bucket**, choose **Yes**, then enter a name for the new S3 bucket\.

   1. To use an existing S3 bucket, for **Create a new S3 bucket**, choose **No**, then select the S3 bucket to use\.

1. Under **Additional settings**, choose **Advanced**\. For **Enable log file validation**, select **Enabled**\.

1. Choose **Create**\.

**To update an existing trail in CloudTrail**

1. Open the CloudTrail console at [https://console\.aws\.amazon\.com/cloudtrail/](https://console.aws.amazon.com/cloudtrail/)\.

1. Choose **Trails**\.

1. In the **Name** column, choose the name of the trail\.

1. For **Management events**, choose **Edit**\.

1. For **Read/Write events**, select **Management events**\.

1. Under **API Activity**, select **Read** and **Write**\.

## \[CloudTrail\.2\] CloudTrail should have encryption at\-rest enabled<a name="cloudtrail-2"></a>

**Related requirements:** PCI DSS v3\.2\.1/3\.4, CIS AWS Foundations Benchmark v1\.2\.0/2\.7, CIS AWS Foundations Benchmark v1\.4\.0/3\.7, NIST\.800\-53\.r5 AU\-9, NIST\.800\-53\.r5 CA\-9\(1\), NIST\.800\-53\.r5 CM\-3\(6\), NIST\.800\-53\.r5 SC\-13, NIST\.800\-53\.r5 SC\-28, NIST\.800\-53\.r5 SC\-28\(1\), NIST\.800\-53\.r5 SC\-7\(10\), NIST\.800\-53\.r5 SI\-7\(6\)

**Category:** Protect > Data protection > Encryption of data at rest

**Severity:** Medium

**Resource type:** `AWS::CloudTrail::Trail`

**AWS Config rule:** [https://docs.aws.amazon.com/config/latest/developerguide/cloud-trail-encryption-enabled.html](https://docs.aws.amazon.com/config/latest/developerguide/cloud-trail-encryption-enabled.html)

**Schedule type:** Periodic

**Parameters:** None

This control checks whether CloudTrail is configured to use the server\-side encryption \(SSE\) AWS KMS key encryption\. The check passes if the `KmsKeyId` is defined\.

For an added layer of security for your sensitive CloudTrail log files, you should use [server\-side encryption with AWS KMS keys \(SSE\-KMS\)](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html) for your CloudTrail log files for encryption at rest\. Note that by default, the log files delivered by CloudTrail to your buckets are encrypted by [Amazon server\-side encryption with Amazon S3\-managed encryption keys \(SSE\-S3\)](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html)\. 

### Remediation<a name="cloudtrail-2-remediation"></a>

To remediate this issue, update your trail to enable SSE\-KMS encryption for the log files\.

**To enable encryption for CloudTrail logs**

1. Open the CloudTrail console at [https://console\.aws\.amazon\.com/cloudtrail/](https://console.aws.amazon.com/cloudtrail/)\.

1. Choose **Trails**\.

1. Choose the trail to update\.

1. Under **General details**, choose **Edit**\.

1. For **Log file SSE\-KMS encryption**, select **Enabled**\.

1. For **Create a new KMS key**, do one of the following:
   + To create a key, choose **New**\. Then in **AWS KMS alias**, enter an alias for the key\. The key is created in the same Region as the S3 bucket\.
   + To use an existing key, choose **Existing**, then from **AWS KMS alias**, choose the key\.

     The AWS KMS key and S3 bucket must be in the same Region\.

1. Choose **Save**\.

   You might need to modify the policy for CloudTrail to successfully interact with your KMS key\. For more information, see [Encrypting CloudTrail log files with AWS KMS keys \(SSE\-KMS\)](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/encrypting-cloudtrail-log-files-with-aws-kms.html) in the *AWS CloudTrail User Guide*\.

## \[CloudTrail\.3\] CloudTrail should be enabled<a name="cloudtrail-3"></a>

**Related requirements:** PCI DSS v3\.2\.1/10\.1, PCI DSS v3\.2\.1/10\.2\.1, PCI DSS v3\.2\.1/10\.2\.2, PCI DSS v3\.2\.1/10\.2\.3, PCI DSS v3\.2\.1/10\.2\.4, PCI DSS v3\.2\.1/10\.2\.5, PCI DSS v3\.2\.1/10\.2\.6, PCI DSS v3\.2\.1/10\.2\.7, PCI DSS v3\.2\.1/10\.3\.1, PCI DSS v3\.2\.1/10\.3\.2, PCI DSS v3\.2\.1/10\.3\.3, PCI DSS v3\.2\.1/10\.3\.4, PCI DSS v3\.2\.1/10\.3\.5, PCI DSS v3\.2\.1/10\.3\.6

**Category:** Identify > Logging

**Severity:** High

**Resource type:** AWS account

**AWS Config rule:** [https://docs.aws.amazon.com/config/latest/developerguide/cloudtrail-enabled.html](https://docs.aws.amazon.com/config/latest/developerguide/cloudtrail-enabled.html)

**Schedule type:** Periodic

**Parameters:** None

This control checks whether CloudTrail is enabled in your AWS account\.

However, some AWS services do not enable logging of all APIs and events\. You should implement any additional audit trails other than CloudTrail and review the documentation for each service in [CloudTrail Supported Services and Integrations](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-aws-service-specific-topics.html)\.

### Remediation<a name="cloudtrail-3-remediation"></a>

**To create a new trail in CloudTrail**

1. Sign in to the AWS Management Console with the credentials you configured for CloudTrail administration\.

1. Open the CloudTrail console at [https://console\.aws\.amazon\.com/cloudtrail/](https://console.aws.amazon.com/cloudtrail/)\.

1. In the **Region** selector, choose the AWS Region where you want your trail to be created\. This is the Home Region for the trail\. 

   The Home Region is the only AWS Region where you can view and update the trail after it is created, even if the trail logs events in all AWS Regions\. 

1. In the navigation pane, choose **Trails**\.

1. On the **Trails** page, choose **Get Started Now**\. If you do not see that option, choose **Create Trail**\. 

1. In **Trail name**, give your trail a name, such as **My\-Management\-Events\-Trail**\.

   As a best practice, use a name that quickly identifies the purpose of the trail\. In this case, you're creating a trail that logs management events\.

1. In **Management Events**, make sure **Read/Write events** is set to **All**\.

1. In **Data Events**, do not make any changes\. This trail will not log any data events\. 

1. Create a new S3 bucket for the logs:

   1. In **Storage Location**, in **Create a new S3 bucket**, choose **Yes**\.

   1. In **S3 bucket**, give your bucket a name, such as **my\-bucket\-for\-storing\-cloudtrail\-logs**\.

      The name of your S3 bucket must be globally unique\. For more information about S3 bucket naming requirements, see the [https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-s3-bucket-naming-requirements.html](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-s3-bucket-naming-requirements.html)\.

   1. Under **Advanced**, choose **Yes** for both **Encrypt log files with SSE\-KMS** and **Enable log file validation**\.

1. Choose **Create**\. 

For more details, see the tutorial in the [https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-tutorial.html](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-tutorial.html)\.

## \[CloudTrail\.4\] CloudTrail log file validation should be enabled<a name="cloudtrail-4"></a>

**Related requirements:** PCI DSS v3\.2\.1/10\.5\.2, PCI DSS v3\.2\.1/10\.5\.5, CIS AWS Foundations Benchmark v1\.2\.0/2\.2, CIS AWS Foundations Benchmark v1\.4\.0/3\.2, NIST\.800\-53\.r5 AU\-9, NIST\.800\-53\.r5 SI\-4, NIST\.800\-53\.r5 SI\-7\(1\), NIST\.800\-53\.r5 SI\-7\(3\), NIST\.800\-53\.r5 SI\-7\(7\)

**Category:** Data protection > Data integrity

**Severity:** Low

**Resource type:** `AWS::CloudTrail::Trail`

**AWS Config rule:** [https://docs.aws.amazon.com/config/latest/developerguide/cloud-trail-log-file-validation-enabled.html](https://docs.aws.amazon.com/config/latest/developerguide/cloud-trail-log-file-validation-enabled.html)

**Schedule type:** Periodic

**Parameters:** None

This control checks whether log file integrity validation is enabled on a CloudTrail trail\.

CloudTrail log file validation creates a digitally signed digest file that contains a hash of each log that CloudTrail writes to Amazon S3\. You can use these digest files to determine whether a log file was changed, deleted, or unchanged after CloudTrail delivered the log\.

Security Hub recommends that you enable file validation on all trails\. Log file validation provides additional integrity checks of CloudTrail logs\.

For more information, see [Enabling validation and validating files](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-log-file-validation-intro.html#cloudtrail-log-file-validation-intro-enabling-and-using) in the *AWS CloudTrail User Guide*\.

### Remediation<a name="cloudtrail-4-remediation"></a>

To remediate this issue, update your CloudTrail trail to enable log file validation\.

**To enable CloudTrail log file validation**

1. Open the CloudTrail console at [https://console\.aws\.amazon\.com/cloudtrail/](https://console.aws.amazon.com/cloudtrail/)\.

1. Choose **Trails**\.

1. Under **Name**, choose the name of a trail to edit\.

1. Under **General details**, choose **Edit**\.

1. Under **Additional settings**, for **Log file validation**, choose **Enabled**\.

1. Choose **Save changes**\.

For more information, see [Validating CloudTrail log file integrity](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-log-file-validation-intro.html) in the *AWS CloudTrail User Guide*\.

## \[CloudTrail\.5\] CloudTrail trails should be integrated with Amazon CloudWatch Logs<a name="cloudtrail-5"></a>

**Related requirements:** PCI DSS v3\.2\.1/10\.5\.3, CIS AWS Foundations Benchmark v1\.2\.0/2\.4, CIS AWS Foundations Benchmark v1\.4\.0/3\.4, NIST\.800\-53\.r5 AC\-2\(4\), NIST\.800\-53\.r5 AC\-4\(26\), NIST\.800\-53\.r5 AC\-6\(9\), NIST\.800\-53\.r5 AU\-10, NIST\.800\-53\.r5 AU\-12, NIST\.800\-53\.r5 AU\-2, NIST\.800\-53\.r5 AU\-3, NIST\.800\-53\.r5 AU\-6\(1\), NIST\.800\-53\.r5 AU\-6\(3\), NIST\.800\-53\.r5 AU\-6\(4\), NIST\.800\-53\.r5 AU\-6\(5\), NIST\.800\-53\.r5 AU\-7\(1\), NIST\.800\-53\.r5 CA\-7, NIST\.800\-53\.r5 SC\-7\(9\), NIST\.800\-53\.r5 SI\-20, NIST\.800\-53\.r5 SI\-3\(8\), NIST\.800\-53\.r5 SI\-4\(20\), NIST\.800\-53\.r5 SI\-4\(5\), NIST\.800\-53\.r5 SI\-7\(8\)

**Category:** Identify > Logging

**Severity:** Low

**Resource type:** `AWS::CloudTrail::Trail`

**AWS Config rule:** [https://docs.aws.amazon.com/config/latest/developerguide/cloud-trail-cloud-watch-logs-enabled.html](https://docs.aws.amazon.com/config/latest/developerguide/cloud-trail-cloud-watch-logs-enabled.html)

**Schedule type:** Periodic

**Parameters:** None

This control checks whether CloudTrail trails are configured to send logs to CloudWatch Logs\. The control fails if the `CloudWatchLogsLogGroupArn` property of the trail is empty\.

CloudTrail records AWS API calls that are made in a given account\. The recorded information includes the following:
+ The identity of the API caller
+ The time of the API call
+ The source IP address of the API caller
+ The request parameters
+ The response elements returned by the AWS service

CloudTrail uses Amazon S3 for log file storage and delivery\. You can capture CloudTrail logs in a specified S3 bucket for long\-term analysis\. To perform real\-time analysis, you can configure CloudTrail to send logs to CloudWatch Logs\.

For a trail that is enabled in all Regions in an account, CloudTrail sends log files from all of those Regions to a CloudWatch Logs log group\.

Security Hub recommends that you send CloudTrail logs to CloudWatch Logs\. Note that this recommendation is intended to ensure that account activity is captured, monitored, and appropriately alarmed on\. You can use CloudWatch Logs to set this up with your AWS services\. This recommendation does not preclude the use of a different solution\.

Sending CloudTrail logs to CloudWatch Logs facilitates real\-time and historic activity logging based on user, API, resource, and IP address\. You can use this approach to establish alarms and notifications for anomalous or sensitivity account activity\.

### Remediation<a name="cloudtrail-5-remediation"></a>

You can use the console to enable CloudTrail integration with CloudWatch Logs\.

**To enable CloudTrail integration with CloudWatch Logs**

1. Open the CloudTrail console at [https://console\.aws\.amazon\.com/cloudtrail/](https://console.aws.amazon.com/cloudtrail/)\.

1. Choose **Trails**\.

1. Choose the trail that does not have a value for **CloudWatch Logs Log group**\.

1. Under **CloudWatch Logs**, choose **Edit**\.

1. Select **Enabled**\.

1. For **Log group**, do one of the following:
   + To use the default log group, keep the name as is\.
   + To use an existing log group, choose **Existing** and then enter the name of the log group to use\.
   + To create a new log group, choose **New** and then enter a name for the log group to create\.

1. For **IAM role**, do one of the following:
   + To use an existing role, choose **Existing** and then choose the role from the drop\-down list\.
   + To create a new role, choose **New** and then enter a name for the role to create\. The new role is assigned a policy that grants the necessary permissions\.

   To view the permissions granted to the role, expand **Policy document**\.

1. Choose **Save changes**\.

For more information, see [Configuring CloudWatch Logs monitoring with the console](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/send-cloudtrail-events-to-cloudwatch-logs.html#send-cloudtrail-events-to-cloudwatch-logs-console) in the *AWS CloudTrail User Guide*\.

## \[CloudTrail\.6\] Ensure the S3 bucket used to store CloudTrail logs is not publicly accessible<a name="cloudtrail-6"></a>

**Related requirements:** CIS AWS Foundations Benchmark v1\.2\.0/2\.3, CIS AWS Foundations Benchmark v1\.4\.0/3\.3

**Category:** Identify > Logging

**Severity:** Critical

**AWS Config rule:** None

**Schedule type:** Periodic and change triggered

CloudTrail logs a record of every API call made in your account\. These log files are stored in an S3 bucket\. CIS recommends that the S3 bucket policy, or access control list \(ACL\), applied to the S3 bucket that CloudTrail logs to prevents public access to the CloudTrail logs\. Allowing public access to CloudTrail log content might aid an adversary in identifying weaknesses in the affected account's use or configuration\.

To run this check, Security Hub first uses custom logic to look for the S3 bucket where your CloudTrail logs are stored\. It then uses the AWS Config managed rules to check that bucket is publicly accessible\.

If you aggregate your logs into a single centralized S3 bucket, then Security Hub only runs the check against the account and Region where the centralized S3 bucket is located\. For other accounts and Regions, the control status is **No data**\.

If the bucket is publicly accessible, the check generates a failed finding\.

**Note**  
This control is not supported in Middle East \(UAE\)\.

### Remediation<a name="cloudtrail-6-remediation"></a>

**To remove public access for an Amazon S3 bucket**

1. Open the Amazon S3 console at [https://console\.aws\.amazon\.com/s3/](https://console.aws.amazon.com/s3/)\.

1. Choose the name of the bucket where your CloudTrail are stored\.

1. Choose **Permissions** and then choose **Public access settings**\.

1. Choose **Edit**, select all four options, and then choose **Save**\.

1. If prompted, enter **confirm** and then choose **Confirm**\.

## \[CloudTrail\.7\] Ensure S3 bucket access logging is enabled on the CloudTrail S3 bucket<a name="cloudtrail-7"></a>

**Related requirements:** CIS AWS Foundations Benchmark v1\.2\.0/2\.6, CIS AWS Foundations Benchmark v1\.4\.0/3\.6

**Category:** Identify > Logging

**Severity:** Low

**AWS Config rule:** None

**Schedule type:** Periodic

S3 bucket access logging generates a log that contains access records for each request made to your S3 bucket\. An access log record contains details about the request, such as the request type, the resources specified in the request worked, and the time and date the request was processed\.

CIS recommends that you enable bucket access logging on the CloudTrail S3 bucket\.

By enabling S3 bucket logging on target S3 buckets, you can capture all events that might affect objects in a target bucket\. Configuring logs to be placed in a separate bucket enables access to log information, which can be useful in security and incident response workflows\.

To run this check, Security Hub first uses custom logic to look for the bucket where your CloudTrail logs are stored and then uses the AWS Config managed rule to check if logging is enabled\.

If CloudTrail delivers log files from multiple AWS accounts into a single destination Amazon S3 bucket, Security Hub evaluates this control only against the destination bucket in the Region where it's located\. This streamlines your findings\. However, you should turn on CloudTrail in all accounts that deliver logs to the destination bucket\. For all accounts except the one that holds the destination bucket, the control status is **No data**\.

If the bucket is publicly accessible, the check generates a failed finding\.

### Remediation<a name="cloudtrail-7-remediation"></a>

**To enable S3 bucket access logging**

1. Open the Amazon S3 console at [https://console\.aws\.amazon\.com/s3/](https://console.aws.amazon.com/s3/)\.

1. Choose the bucket used for CloudTrail\.

1. Choose **Properties**\.

1. Choose **Server access logging**, then choose **Enable logging**\.

1. Select a bucket from the **Target bucket** list, and optionally enter a prefix\.

1. Choose **Save**\.